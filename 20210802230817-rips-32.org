:PROPERTIES:
:ID:        76a73bd0-4515-464e-9cb8-c161315b2bd3
:ROAM_REFS: https://web.archive.org/web/20190328023701/https://www.ripstech.com/php-security-calendar-2018/
:END:
#+title: rips-32
#+filetags: :vcdb:php:

* Description

* Code
#+begin_src php
$page = 'extensions/' . $_GET['extension'];
$google_analytics = "&lt;script type='text/javascript'>";
$google_analytics .= "ga('create', '$profile', 'auto');";
$google_analytics .= "ga('set', {";
$google_analytics .= "'userId': '$current_user->user_email',";
$google_analytics .= "'page': '$page'";
$google_analytics .= "});";
$google_analytics .= "ga('send', 'pageview');";

echo $google_analytics;

#+end_src

* Solution
#+begin_src php
// 1) $page has user input
$page = 'extensions/' . $_GET['extension'];
$google_analytics = "&lt;script type='text/javascript'>";
$google_analytics .= "ga('create', '$profile', 'auto');";
$google_analytics .= "ga('set', {";
$google_analytics .= "'userId': '$current_user->user_email',";
// 2) $page is not sanitized ==> XSS
$google_analytics .= "'page': '$page'";
$google_analytics .= "});";
$google_analytics .= "ga('send', 'pageview');";

echo $google_analytics;
          
// example
// $_GET['extension'] = aaa.html'});alert(1)/*
// extensions/aaa.html'});alert(1)/*



#+end_src