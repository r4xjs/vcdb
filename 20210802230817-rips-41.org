:PROPERTIES:
:ID:        e0dc3f56-55c5-49ac-9d7d-215875162bcd
:ROAM_REFS: https://twitter.com/ripstech/status/1106525198851948545
:END:
#+title: rips-41
#+filetags: :vcdb:php:

* Description

* Code
#+begin_src php
extract($_POST);

function goAway() {
    error_log("Hacking attempt.");
    header('Location: /error/');
}

if(!isset($pi) || !is_numeric($pi)) {
    goAway();
}

if(!assert("(int)$pi == 3")) {
    echo "This is not pi.";
} else {
    echo "This might be pi.";
}


#+end_src

* Solution
#+begin_src php
// 1) user input can overwrit arbitrary vars
extract($_POST);

function goAway() {
    error_log("Hacking attempt.");
    header('Location: /error/');
    // 3) php will continue to execute an return
}

// 2) if we enter a string we will execute goAway() function
if(!isset($pi) || !is_numeric($pi)) {
    goAway();
}

// 3) code exection inside assert string
if(!assert("(int)$pi == 3")) {
    echo "This is not pi.";
} else {
    echo "This might be pi.";
}

// example:
//POST data: pi=exec('echo 123 > /tmp/out')
//
// php.ini
// zend.assertions = 1

#+end_src